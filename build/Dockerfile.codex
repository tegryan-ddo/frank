# Frank Codex Worker Container
# Lightweight headless container for OpenAI Codex task execution
FROM public.ecr.aws/docker/library/node:20-slim

LABEL maintainer="frank-cli"
LABEL description="Frank Codex headless worker container"
LABEL org.opencontainers.image.source="https://github.com/barff/frank"

# Prevent interactive prompts
ENV DEBIAN_FRONTEND=noninteractive
ENV LANG=C.UTF-8
ENV LC_ALL=C.UTF-8

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    curl \
    jq \
    openssh-client \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Install Codex CLI
RUN npm install -g @openai/codex

# Create workspace directory
RUN mkdir -p /workspace

# Copy entrypoint script
COPY build/entrypoint-codex.sh /usr/local/bin/entrypoint-codex.sh
RUN chmod +x /usr/local/bin/entrypoint-codex.sh

# Set environment variables
ENV HOME=/root

WORKDIR /workspace

ENTRYPOINT ["/usr/local/bin/entrypoint-codex.sh"]
